<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript">
        $(function () {
            //统一的ajax异常报错
            $(document).ajaxError(function (e, jqxhr, settings, exception) {
                if (console) { console.error("AJAX网络请求出错：" + exception); }
            });

            function getDateTime(jsondate) {
                jsondate = jsondate.replace("/Date(", "").replace(")/", "");
                var date = new Date(parseInt(jsondate, 10));
                return date.getFullYear() + "-"
                    + prefix0(date.getMonth() + 1) + "-"
                    + prefix0(date.getDate()) + " "
                    + prefix0(date.getHours()) + ":"
                    + prefix0(date.getMinutes()) + ":"
                    + prefix0(date.getSeconds());
            }
            function prefix0(value) {
                return (value < 10 ? '0' + value : value);
            }

            $("#btn").click(function () {

                var username = $("#txt1").val();
                var txttime1 = $("#txt2").val();
                var txttime2 = $("#txt3").val();
                var describe = $("#txt4").val();
                $.ajax({
                    type: "post",
                    url: "AdminOperationLogSerach.ashx",
                    data: { action: "log", username: username, txttime1: txttime1, txttime2: txttime2, describe: describe },
                    success: function (data) {
                        if (data.status == "error") {
                            alert(data.msg);
                        }
                        else if (data.status == "ok") {

                            for (var i = 0; i < data.data.length; i++) {
                                $("#tbody").append("<tr>").append("<td>" + data.data[i].Id + "</td>")
                                .append("<td>" + data.data[i].UserId + "</td>")
                                .append("<td>" + getDateTime(data.data[i].CreatDateTime) + "</td>")
                                .append("<td>" + data.data[i].Description + "</td></tr>");
                            }
                        }
                        else {
                            alert("statues出错");
                        }
                    },
                    error: function () {
                        alert("获取日志请求出错！");
                    }
                })

            })
        })
    </script>
</head>
<body>
    用户名：<input type="text" id="txt1" /><br />

    操作时间，从<input type="date" id="txt2" />到<input type="date" id="txt3" /><br />
    操作描述包含<input type="text" id="txt4" /><br />
    <input type="button" value="搜索" id="btn" />
    <table>
        <thead>
            <tr><th>Id</th><th>UserId</th><th>CreatDateTime</th><th>Description</th></tr>
        </thead>
        <tbody id="tbody"></tbody>

    </table>
</body>
</html>
